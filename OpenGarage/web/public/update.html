<!DOCTYPE html>
<html>

<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <title>Open Garage | Firmware Update</title>
    <link href="./output.css" rel="stylesheet">
</head>

<body>
    <div class="drawer">
        <input id="og-drawer" type="checkbox" class="drawer-toggle" />
        <div class="drawer-content max-h-screen flex flex-col" id="drawer-content">
            <form id="update-form" class="flex-1 overflow-auto flex flex-col gap-4 p-4" method="POST" enctype="multipart/form-data">
                <fieldset class="fieldset">
                            <legend class="fieldset-legend">Firmware File</legend>
                            <input type="file" name="file" accept=".bin" class="file-input" />
                            </fieldset>

                            <label class="floating-label">
                    <span>Device Key</span>
                    <input type="password" id="key-input" name="d-key" placeholder="Device Key"
                        class="input input-bordered w-full max-w-md" />
                </label>
                <button class="btn btn-wide btn-primary" type="submit">Upload Firmware</button>
            </form>

            Uploading
        </div>
        <div class="drawer-side z-10">
            <label for="og-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
            <div class="flex flex-col min-h-full bg-base-200 z-10" id="drawer-inner">
            </div>
        </div>
    </div>

    <script type="module">
        import { initalize, garageFetch, sendCommand, updateTitle, updateVersion } from "./common.js";
        initalize(new URL("http://192.168.0.104/update" + "/..").href);

        const form = document.getElementById("update-form");

        async function sendUpdate(formData) {
            // let postURL = new URL(window.location);
            let postURL = new URL("http://192.168.0.104/update");
            postURL.port = 8080;

            const res = await fetch(postURL, {
            method: "POST",
            body: formData,
            });
           
            console.log(res);
        }

        form.addEventListener("submit", (event) => {
            event.preventDefault();
            const formData = new FormData(form);
            sendUpdate(formData);
            return false;
        });
    </script>
</body>

</html>